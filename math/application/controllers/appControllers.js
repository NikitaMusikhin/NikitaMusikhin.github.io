angular.module("User",["ngResource","ngStorage"]).controller("regCtrl",["$scope","$location","UserService",function(e,t,r){e.addNewUser=function(n){r.user.create(n,function(e){alert("Поздравляем,вы успешно зарегистрированы!"),t.path("/login")},function(){alert("So sad")}),e.regForm.$setPristine(),e.user={}},e.getError=function(e){if(angular.isDefined(e)){if(e.required)return"Поле не должно быть пустым";if(e.minlength)return"В данное поле должно быть введено более 6 символов";if(e.email)return"Введите корректные данные"}}}]).controller("loginCtrl",["$scope","$rootScope","$http","$location","UserService","TokenService",function(e,t,r,n,o,a){e.authorize=function(e){o.auth.login(e,function(e){a.setToken(e.token),t.user=e.user,n.path("/dashboard")},function(){alert(":(")})}}]).controller("profCtrl",["$scope","$rootScope","$localStorage","$location","UserService",function(e,t,r,n,o){function a(e){var t=e;this.__defineGetter__("qty",function(){return t}),this.__defineSetter__("qty",function(e){t=parseInt(e)})}e.logout=function(){o.out.logout({},function(e){delete r.token,n.path("/login")},function(){alert(":(")})},r.token?t.user||o.mathContext.isToken({},function(e){t.user=e.user},function(){n.path("/login")}):n.path("/login"),t.$watch("user",function(){e.profile=t.user}),e.qty_add=new a(2),e.qty_sub=new a(2),e.qty_mull=new a(2),e.qty_div=new a(2),e.selectoObj=function(t){switch(t){case"add":return e.qty_add.qty;case"sub":return e.qty_sub.qty;case"mull":return e.qty_mull.qty;case"div":return e.qty_div.qty}},e.setExampleSettings=function(t){r.typeExample=t,r.modeExample=e.selectoObj(t)}}]).controller("exampleCtrl",["$scope","$rootScope","$localStorage","$location","UserService","TokenService",function(e,t,r,n,o,a){r.token?t.user||o.mathContext.isToken({},function(e){t.user=e.user},function(){n.path("/login")}):n.path("/login"),t.$watch("user",function(){e.profile=t.user}),r.typeExample&&r.modeExample?e.settings={type:r.typeExample,mode:r.modeExample}:n.path("/dashboard"),e.counter={wrong:0,right:0,overall:0},e.view={blockInput:!0,blockAnswer:!1},e.startSolutions=function(){e.counter.overall=0,e.counter.right=0,e.counter.wrong=0,e.view.blockInput=!1,e.view.blockAnswer=!0,e.generateNewExample()},e.generateNewExample=function(){if(e.counter.overall<10){var t=e.getNumbers();switch(e.settings.type){case"add":var r=t.reduce(function(e,t){return e+t});e.example={primer:t.join(" + ")+" = "+r,otvet:parseInt(r)};break;case"sub":var r=t.reduce(function(e,t){return e-t});e.example={primer:t.join(" - ")+" = "+r,otvet:parseInt(r)};break;case"mull":var r=t.reduce(function(e,t){return e*t});e.example={primer:t.join(" * ")+" = "+r,otvet:parseInt(r)};break;case"div":var r=t.reduce(function(e,t){return e/t});e.example={primer:t.join(" / ")+" = "+r,otvet:parseInt(r)};break;default:n.path("/dashboard")}e.exampleReady=!0,e.example.userAnswer=parseInt("")}else e.sendResult(),e.example.userAnswer="",e.view.blockInput=!0,e.view.blockAnswer=!1},e.sendResult=function(){switch(e.settings.type){case"add":alert(JSON.stringify(e.counter));break;case"sub":alert(JSON.stringify(e.counter));break;case"mull":alert(JSON.stringify(e.counter));break;case"div":alert(JSON.stringify(e.counter));break;default:alert("error")}},e.saveSolution=function(t){t==e.example.otvet?e.counter.right++:e.counter.wrong++,e.counter.overall++},e.getNumbers=function(){for(var t=[],r=0;r<e.settings.mode;r++)t.push(e.getRandomNumber());return t},e.getRandomNumber=function(){return Math.floor(6*Math.random()+1)}}]);